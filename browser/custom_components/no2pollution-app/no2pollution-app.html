<link rel="import" href="../../bower_components/polymer/polymer.html" />

<!-- Iron -->
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html" />
<!-- Paper -->
<link rel="import" href="../../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html" />
<link rel="import" href="../../bower_components/paper-input/paper-input.html" />
<!-- Neon -->
<!-- Custom/Behaviors -->
<!-- Other -->
<link rel="import" href="../../bower_components/geo-location/geo-location.html">
<link rel="import" href="../../bower_components/google-apis/google-maps-api.html" />
<link rel="import" href="../../bower_components/google-map/google-map.html" />
<link rel="import" href="../../bower_components/google-map/google-map-search.html" />
<link rel="import" href="../../bower_components/google-map/google-map-marker.html" />
<link rel="import" href="../../bower_components/google-map/google-map-point.html" />
<link rel="import" href="../../bower_components/google-map/google-map-poly.html" />

<dom-module id="no2pollution-app">
    <link rel="import" type="css" href="no2pollution-app.css?__inline" />
    <template>
        <iron-ajax id="ajax" url="https://no2pollution.herokuapp.com/api/v1/route"></iron-ajax>

        <geo-location watch-pos high-accuracy latitude="{{userLatitude}}" longitude="{{userLongitude}}"></geo-location>
        <google-maps-api api-key="[[apiKey]]" version="3.exp" on-api-load="on_api_load"></google-maps-api>
        <park-finder api-key="[[apiKey]]"></park-finder>

        <google-map id="map-canvas" map="{{map}}" api-key="[[apiKey]]" class="fit" latitude="51.5100" longitude="-360.1212" mouse-events>
            <google-map-search map="[[map]]" query="{{criteria}}" results="{{results}}"></google-map-search>
            <google-map-marker id="myLocationMarker" latitude="[[userLatitude]]" longitude="[[userLongitude]]"></google-map-marker>
            <google-map-marker id="parkMarker"></google-map-marker>
            <map-circle></map-circle>

            <template is="dom-repeat" items="{{results}}" as="marker">
                <google-map-marker latitude="{{marker.latitude}}" longitude="{{marker.longitude}}">
                    <h2>{{marker.name}}</h2>
                    <span>{{marker.formatted_address}}</span>
                    <div layout vertical center>
                        <!-- This is a horrendous hackaround caused by google-map#235 -->
                        <paper-button class="colorful" onclick="document.querySelector('no2pollution-app').routeBtnOnTap(this)" location$="{{marker}}">Route me</paper-button>
                    </div>
                </google-map-marker>
            </template>

            <google-map-poly>
                <template is="dom-repeat" items="{{path}}">
                    <google-map-point latitude="{{item.lat}}" longitude="{{item.lng}}"></google-map-point>
                </template>
            </google-map-poly>
        </google-map>

        <!-- Menu -->
        <paper-fab-menu id="menu"></paper-fab-menu>

        <!-- Search Dialog -->
        <paper-dialog id="search-dialog" class="search-dialog-pos">
            <paper-input id="search-input-text" label="Search" on-keydown="srchReqOnEnter" value="{{srchInput}}" autofocus="true"></paper-input>
        </paper-dialog>
    </template>
    <script src="no2pollution-app.js?__inline"></script>
</dom-module>
